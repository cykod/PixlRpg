// Abacus - v0.0.0 - 11/19/2011
// 
// ; Licensed 
(function(a){var b={},c=[].slice,d={}.toString,e={}.hasOwnProperty;b.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a=="x"?b:b&3|8;return c.toString(16)}).toUpperCase()},b.clone=function(c){var d=[],e,f,g,h;if(Array.isArray(c)){for(h=0,g=c.length;h<g;h++)f=c[h],typeof f=="object"&&(f=b.clone(f)),d[h]=f;return d}return e=Object.getPrototypeOf(c).constructor.name,/(.+)Array$/.test(e)?new a[e](c):Object.create({},function(a){var c={};return Object.getOwnPropertyNames(a).forEach(function(d){var e=Object.getOwnPropertyDescriptor(a,d);typeof a[d]=="object"&&(e.value=b.clone(a[d])),c[d]=e}),c}(c))},b.extend=function(a){var d,e,f=c.call(arguments,1),g=f.length,h=0;for(;h<g;h++){d=b.clone(f[h]);for(e in d)a[e]=d[e]}return a},b.noop=function(){},b.identity=function(a){return a},b.prefix=function(a){return["webkit","moz","ms","o"].filter(function(b){return b+"RequestAnimationFrame"in a})[0]||""}(a),a.Abacus=b})(this),function(a,b){function f(a){return a=a||{},this.id=a.id||b.guid(),this.lastTick=0,this.lastStart=0,this.until=0,this.isPaused=!1,this.timing={delta:0,sinceStart:0,ticks:0},this.loop=function(){var b=Date.now();this.timing.delta=b-this.lastTick,this.timing.sinceStart=b-this.lastStart,this.lastTick=b,this.isPaused||this.until!=null&&this.lastTick-this.lastStart>this.until&&this.timing.ticks!==0?(this.stop(),a.complete&&a.complete(this.timing)):(a.callback&&a.callback.call(this,this.timing),this.timing.ticks++)}.bind(this),this.stop=function(){d.splice(d.indexOf(this.loop||b.noop),1)}.bind(this),this}var c=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b,c){a.setTimeout(b,1e3/60)}}(),d=[],e=function(){var a=d.length,b=a-1;a&&c(e),e.running=!!a;for(;b>=0;--b)d[b]()};f.prototype={start:function(a){this.lastStart=Date.now(),this.until=a,this.lastTick=this.lastStart,this.isPaused=!1,d.push(this.loop),e.running||c(e)},pause:function(){this.isPaused=!0}},b.timer=function(a){return new f(a)}}(this,this.Abacus),function(a,b){function d(a){var d;if(a){d=typeof a;if(d==="string")return c[a]||b.noop;if(d==="function")return a}return b.noop}function e(a){a=a||{},this.index=a.index||0,this.start=a.start||0,this.stop=a.stop||0;var b=d(a.type);this.get=function(a){return a!=null&&(this.index=a),b(this.start,this.stop,this.index)},Object.defineProperty(this,"type",{get:function(){return b},set:function(a){d(a)}})}var c={linear:function(a,b,c){return(b-a)*c+a}};b.tween=function(a){return new e(a)}}(this,this.Abacus),function(a,b){function c(a){var b=typeof a=="object"?Object.getPrototypeOf(a).constructor.name:"NotObject";return b}function d(a){var b=c(a);return/(.+)Array$/.test(b)?!0:!1}function e(a,b,c,d,f,g,h){var i=-1,j=d.length/2,k,l;while(++i<j)k=d[i],l=c[i],l===!0?f[k]=g(a[k],b[k],h):e(a[k],b[k],l,d[j+i],f[k],g,h)}function f(a){function g(a){return typeof a=="number"?!0:f(a)}var b=[],c,e;if(Array.isArray(a)||d(a))for(c=0,e=a.length;c<e;c++)b.push(g(a[c]));else for(c in a)b.push(g(a[c]));return b}function g(a,b){var c,e;if(Array.isArray(a)||d(a))for(c=0,e=a.length;c<e;c++)b.push(c);else for(c in a)b.push(c);for(c=0,e=b.length;c<e;c++)b.push(g(a[c],[]));return b}function h(a){b.extend(this,a),this.tween&&(this.tween=b.tween({type:this.tween})),this.tweenable=f(this.value),this.keys=g(this.value,[])}function i(a){a=a||{},b.extend(this,a),this.tween&&(this.tween=b.tween({type:this.tween})),this.frames||(this.frames=[]),this.frameIndex=-1}function j(a){b.extend(this,a),this.tween&&(this.tween=b.tween({type:this.tween})),this.layers||(this.layers=[])}i.prototype={reset:function(){this.frameIndex=-1},addFrame:function(a){var c=!1,d=this.frames.length,e=0;a instanceof h||(a=b.animation.frame(a));for(;e<d;e++)if(this.frames[e].index>a.index){this.frames.splice(e,0,a),c=!0;break}return c||this.frames.push(a),this},getFrame:function(a){var b=this.frames,c=b.length,d=0;for(;d<c;d++)if(b[d].index===a)return b[d];return null},removeFrame:function(a){var b=this.frames,c=b.length,d=0;a instanceof h&&(a=a.index);for(;d<c;d++)if(b[d].index===a){b.splice(d,1);break}},step:function(a,b,c){var d=c.sinceStart/1e3,f=this.frameIndex,g=this.frames[f],h=this.frames[f+1],i;if(h==null)return!1;if(g&&g.index/a.rate>d)return!0;if(h.index/a.rate<=d){for(f++;f<this.frames.length;f++){i=f+1,f===0&&h.beforeTween&&h.beforeTween(),g=this.frames[f],h=this.frames[i],h&&h.beforeTween&&h.beforeTween(),g&&g.afterTween&&g.afterTween();if(this.frames[i]&&this.frames[i].index/a.rate>d||!this.frames[i])break}this.frameIndex=f;if(h==null)return!1}return g&&h&&e(g.value,h.value,h.tweenable,h.keys,b,(h.tween||this.tween||a.tween).type,(d-g.index/a.rate)*a.rate/(h.index-g.index)),!0}},j.prototype={start:function(a){function d(b){var d=c.layers,e=!0,f;for(f=0;f<d.length;f++)e=d[f].step(c,a,b)&&e;e||c.stop()}var c=this;return this.timer||(this.timer=b.timer({callback:d})),this.timer.start(),this},stop:function(){return this.timer&&this.timer.pause(),this.reset(),this},reset:function(){return this.layers.forEach(function(a){a.reset()}),this},addLayer:function(a){var b=this.layers.length;return this.layers.push(a),a.index=b,this},layer:function(a){var c,d;if(a==null)return c=b.animation.layer(),this.addLayer(c),c;if(this.layers[a])return this.layers[a];if(typeof a=="object"){d=a;if(d.index!=null){if(d.index<this.layers.length)return c=this.layers[d.index],b.extend(c,d),c;throw{type:"ArgumentException",message:"layer with given index ("+d.index+") must exist before calling layer(...) with object",argument:d}}return c=b.animation.layer(d),this.addLayer(c),c}throw{type:"ArgumentException",message:"layer must be called with undefined, a number, or an object",argument:a}}},b.animation=function(a){return new j(a)},b.animation.layer=function(a){return new i(a)},b.animation.frame=function(a){return new h(a)}}(this,this.Abacus)